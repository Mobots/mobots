   1              		.syntax unified
   2              		.cpu cortex-m3
   3              		.fpu softvfp
   4              		.eabi_attribute 20, 1
   5              		.eabi_attribute 21, 1
   6              		.eabi_attribute 23, 3
   7              		.eabi_attribute 24, 1
   8              		.eabi_attribute 25, 1
   9              		.eabi_attribute 26, 1
  10              		.eabi_attribute 30, 6
  11              		.eabi_attribute 34, 1
  12              		.eabi_attribute 18, 4
  13              		.thumb
  14              		.file	"i2c.c"
  15              		.text
  16              	.Ltext0:
  17              		.cfi_sections	.debug_frame
  18              		.align	2
  19              		.global	i2c_cofig
  20              		.thumb
  21              		.thumb_func
  23              	i2c_cofig:
  24              	.LFB29:
  25              		.file 1 "../i2c.c"
   1:../i2c.c      **** /*
   2:../i2c.c      ****  * i2c.c
   3:../i2c.c      ****  *
   4:../i2c.c      ****  *  Created on: 12.06.2012
   5:../i2c.c      ****  *      Author: simon
   6:../i2c.c      ****  */
   7:../i2c.c      **** #include "stm32f10x_rcc.h"
   8:../i2c.c      **** #include "stm32f10x_i2c.h"
   9:../i2c.c      **** #include "misc.h"
  10:../i2c.c      **** 
  11:../i2c.c      **** void i2c_cofig(void)
  12:../i2c.c      **** {
  26              		.loc 1 12 0
  27              		.cfi_startproc
  28              		@ args = 0, pretend = 0, frame = 32
  29              		@ frame_needed = 1, uses_anonymous_args = 0
  30 0000 80B5     		push	{r7, lr}
  31              	.LCFI0:
  32              		.cfi_def_cfa_offset 8
  33              		.cfi_offset 14, -4
  34              		.cfi_offset 7, -8
  35 0002 88B0     		sub	sp, sp, #32
  36              	.LCFI1:
  37              		.cfi_def_cfa_offset 40
  38 0004 00AF     		add	r7, sp, #0
  39              	.LCFI2:
  40              		.cfi_def_cfa_register 7
  13:../i2c.c      **** 
  14:../i2c.c      **** 	// Clock
  15:../i2c.c      **** 	RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOB | RCC_APB2Periph_AFIO, ENABLE);
  41              		.loc 1 15 0
  42 0006 4FF00900 		mov	r0, #9
  43 000a 4FF00101 		mov	r1, #1
  44 000e FFF7FEFF 		bl	RCC_APB2PeriphClockCmd
  16:../i2c.c      **** 	RCC_APB1PeriphClockCmd(RCC_APB1Periph_I2C1, ENABLE);
  45              		.loc 1 16 0
  46 0012 4FF40010 		mov	r0, #2097152
  47 0016 4FF00101 		mov	r1, #1
  48 001a FFF7FEFF 		bl	RCC_APB1PeriphClockCmd
  17:../i2c.c      **** 
  18:../i2c.c      **** 	I2C_DeInit(I2C1);
  49              		.loc 1 18 0
  50 001e 4FF4A840 		mov	r0, #21504
  51 0022 C4F20000 		movt	r0, 16384
  52 0026 FFF7FEFF 		bl	I2C_DeInit
  19:../i2c.c      **** 
  20:../i2c.c      **** 	// GPIOS
  21:../i2c.c      **** 	GPIO_InitTypeDef GPIO_InitStructure;
  22:../i2c.c      **** 	GPIO_StructInit(&GPIO_InitStructure);
  53              		.loc 1 22 0
  54 002a 07F11803 		add	r3, r7, #24
  55 002e 1846     		mov	r0, r3
  56 0030 FFF7FEFF 		bl	GPIO_StructInit
  23:../i2c.c      **** 	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_6 | GPIO_Pin_7;
  57              		.loc 1 23 0
  58 0034 4FF0C003 		mov	r3, #192
  59 0038 3B83     		strh	r3, [r7, #24]	@ movhi
  24:../i2c.c      **** 	GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;
  60              		.loc 1 24 0
  61 003a 4FF00303 		mov	r3, #3
  62 003e BB76     		strb	r3, [r7, #26]
  25:../i2c.c      **** 	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_IN_FLOATING;
  63              		.loc 1 25 0
  64 0040 4FF00403 		mov	r3, #4
  65 0044 FB76     		strb	r3, [r7, #27]
  26:../i2c.c      **** 	GPIO_Init(GPIOB, &GPIO_InitStructure);
  66              		.loc 1 26 0
  67 0046 07F11803 		add	r3, r7, #24
  68 004a 4FF44060 		mov	r0, #3072
  69 004e C4F20100 		movt	r0, 16385
  70 0052 1946     		mov	r1, r3
  71 0054 FFF7FEFF 		bl	GPIO_Init
  27:../i2c.c      **** 
  28:../i2c.c      **** 	int wait = 20000;
  72              		.loc 1 28 0
  73 0058 44F62063 		movw	r3, #20000
  74 005c FB61     		str	r3, [r7, #28]
  29:../i2c.c      **** 	while (wait--)
  75              		.loc 1 29 0
  76 005e 00BF     		nop
  77              	.L2:
  78              		.loc 1 29 0 is_stmt 0 discriminator 1
  79 0060 FB69     		ldr	r3, [r7, #28]
  80 0062 002B     		cmp	r3, #0
  81 0064 0CBF     		ite	eq
  82 0066 0023     		moveq	r3, #0
  83 0068 0123     		movne	r3, #1
  84 006a DBB2     		uxtb	r3, r3
  85 006c FA69     		ldr	r2, [r7, #28]
  86 006e 02F1FF32 		add	r2, r2, #-1
  87 0072 FA61     		str	r2, [r7, #28]
  88 0074 002B     		cmp	r3, #0
  89 0076 F3D1     		bne	.L2
  30:../i2c.c      **** 		;
  31:../i2c.c      **** 
  32:../i2c.c      **** 	GPIO_StructInit(&GPIO_InitStructure);
  90              		.loc 1 32 0 is_stmt 1
  91 0078 07F11803 		add	r3, r7, #24
  92 007c 1846     		mov	r0, r3
  93 007e FFF7FEFF 		bl	GPIO_StructInit
  33:../i2c.c      **** 	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_6 | GPIO_Pin_7;
  94              		.loc 1 33 0
  95 0082 4FF0C003 		mov	r3, #192
  96 0086 3B83     		strh	r3, [r7, #24]	@ movhi
  34:../i2c.c      **** 	GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;
  97              		.loc 1 34 0
  98 0088 4FF00303 		mov	r3, #3
  99 008c BB76     		strb	r3, [r7, #26]
  35:../i2c.c      **** 	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AF_OD;
 100              		.loc 1 35 0
 101 008e 4FF01C03 		mov	r3, #28
 102 0092 FB76     		strb	r3, [r7, #27]
  36:../i2c.c      **** 	GPIO_Init(GPIOB, &GPIO_InitStructure);
 103              		.loc 1 36 0
 104 0094 07F11803 		add	r3, r7, #24
 105 0098 4FF44060 		mov	r0, #3072
 106 009c C4F20100 		movt	r0, 16385
 107 00a0 1946     		mov	r1, r3
 108 00a2 FFF7FEFF 		bl	GPIO_Init
  37:../i2c.c      **** 
  38:../i2c.c      **** 	// I2C
  39:../i2c.c      **** 	I2C_InitTypeDef I2C_InitStructure;
  40:../i2c.c      **** 	I2C_StructInit(&I2C_InitStructure);
 109              		.loc 1 40 0
 110 00a6 07F10803 		add	r3, r7, #8
 111 00aa 1846     		mov	r0, r3
 112 00ac FFF7FEFF 		bl	I2C_StructInit
  41:../i2c.c      **** 	I2C_InitStructure.I2C_Mode = I2C_DutyCycle_2;
 113              		.loc 1 41 0
 114 00b0 4BF6FF73 		movw	r3, #49151
 115 00b4 BB81     		strh	r3, [r7, #12]	@ movhi
  42:../i2c.c      **** 	I2C_InitStructure.I2C_OwnAddress1 = 0x22;
 116              		.loc 1 42 0
 117 00b6 4FF02203 		mov	r3, #34
 118 00ba 3B82     		strh	r3, [r7, #16]	@ movhi
  43:../i2c.c      **** 	I2C_InitStructure.I2C_Ack = I2C_Ack_Enable;
 119              		.loc 1 43 0
 120 00bc 4FF48063 		mov	r3, #1024
 121 00c0 7B82     		strh	r3, [r7, #18]	@ movhi
  44:../i2c.c      **** 	I2C_InitStructure.I2C_AcknowledgedAddress = I2C_AcknowledgedAddress_7bit;
 122              		.loc 1 44 0
 123 00c2 4FF48043 		mov	r3, #16384
 124 00c6 BB82     		strh	r3, [r7, #20]	@ movhi
  45:../i2c.c      **** 	I2C_InitStructure.I2C_ClockSpeed = 100000;
 125              		.loc 1 45 0
 126 00c8 48F2A063 		movw	r3, #34464
 127 00cc C0F20103 		movt	r3, 1
 128 00d0 BB60     		str	r3, [r7, #8]
  46:../i2c.c      **** 	I2C_Init(I2C1, &I2C_InitStructure);
 129              		.loc 1 46 0
 130 00d2 07F10803 		add	r3, r7, #8
 131 00d6 4FF4A840 		mov	r0, #21504
 132 00da C4F20000 		movt	r0, 16384
 133 00de 1946     		mov	r1, r3
 134 00e0 FFF7FEFF 		bl	I2C_Init
  47:../i2c.c      **** 
  48:../i2c.c      **** 	I2C_Cmd(I2C1, ENABLE);
 135              		.loc 1 48 0
 136 00e4 4FF4A840 		mov	r0, #21504
 137 00e8 C4F20000 		movt	r0, 16384
 138 00ec 4FF00101 		mov	r1, #1
 139 00f0 FFF7FEFF 		bl	I2C_Cmd
  49:../i2c.c      **** 
  50:../i2c.c      **** 	NVIC_InitTypeDef NVIC_InitStructure;
  51:../i2c.c      **** 	NVIC_InitStructure.NVIC_IRQChannel = I2C1_ER_IRQn;
 140              		.loc 1 51 0
 141 00f4 4FF02003 		mov	r3, #32
 142 00f8 3B71     		strb	r3, [r7, #4]
  52:../i2c.c      **** 	NVIC_InitStructure.NVIC_IRQChannelPreemptionPriority = 1;
 143              		.loc 1 52 0
 144 00fa 4FF00103 		mov	r3, #1
 145 00fe 7B71     		strb	r3, [r7, #5]
  53:../i2c.c      **** 	NVIC_InitStructure.NVIC_IRQChannelSubPriority = 0;
 146              		.loc 1 53 0
 147 0100 4FF00003 		mov	r3, #0
 148 0104 BB71     		strb	r3, [r7, #6]
  54:../i2c.c      **** 	NVIC_InitStructure.NVIC_IRQChannelCmd = ENABLE;
 149              		.loc 1 54 0
 150 0106 4FF00103 		mov	r3, #1
 151 010a FB71     		strb	r3, [r7, #7]
  55:../i2c.c      **** 	NVIC_Init(&NVIC_InitStructure);
 152              		.loc 1 55 0
 153 010c 07F10403 		add	r3, r7, #4
 154 0110 1846     		mov	r0, r3
 155 0112 FFF7FEFF 		bl	NVIC_Init
  56:../i2c.c      **** 
  57:../i2c.c      **** 	NVIC_InitStructure.NVIC_IRQChannel = I2C1_EV_IRQn;
 156              		.loc 1 57 0
 157 0116 4FF01F03 		mov	r3, #31
 158 011a 3B71     		strb	r3, [r7, #4]
  58:../i2c.c      **** 	NVIC_InitStructure.NVIC_IRQChannelSubPriority = 1;
 159              		.loc 1 58 0
 160 011c 4FF00103 		mov	r3, #1
 161 0120 BB71     		strb	r3, [r7, #6]
  59:../i2c.c      **** 	NVIC_Init(&NVIC_InitStructure);
 162              		.loc 1 59 0
 163 0122 07F10403 		add	r3, r7, #4
 164 0126 1846     		mov	r0, r3
 165 0128 FFF7FEFF 		bl	NVIC_Init
  60:../i2c.c      **** 
  61:../i2c.c      **** 	I2C_CalculatePEC(I2C1, DISABLE);
 166              		.loc 1 61 0
 167 012c 4FF4A840 		mov	r0, #21504
 168 0130 C4F20000 		movt	r0, 16384
 169 0134 4FF00001 		mov	r1, #0
 170 0138 FFF7FEFF 		bl	I2C_CalculatePEC
  62:../i2c.c      **** 	I2C_ITConfig(I2C1, I2C_IT_EVT | I2C_IT_BUF | I2C_IT_ERR, ENABLE);
 171              		.loc 1 62 0
 172 013c 4FF4A840 		mov	r0, #21504
 173 0140 C4F20000 		movt	r0, 16384
 174 0144 4FF4E061 		mov	r1, #1792
 175 0148 4FF00102 		mov	r2, #1
 176 014c FFF7FEFF 		bl	I2C_ITConfig
  63:../i2c.c      **** 
  64:../i2c.c      **** }
 177              		.loc 1 64 0
 178 0150 07F12007 		add	r7, r7, #32
 179 0154 BD46     		mov	sp, r7
 180 0156 80BD     		pop	{r7, pc}
 181              		.cfi_endproc
 182              	.LFE29:
 184              		.global	dgbcnt_ER
 185              		.bss
 186              		.align	2
 189              	dgbcnt_ER:
 190 0000 00000000 		.space	4
 191              		.global	dgbcnt_EV
 192              		.align	2
 195              	dgbcnt_EV:
 196 0004 00000000 		.space	4
 197              		.text
 198              		.align	2
 199              		.global	I2C1_ER_IRQHandler
 200              		.thumb
 201              		.thumb_func
 203              	I2C1_ER_IRQHandler:
 204              	.LFB30:
  65:../i2c.c      **** 
  66:../i2c.c      **** int dgbcnt_ER = 0, dgbcnt_EV = 0;
  67:../i2c.c      **** 
  68:../i2c.c      **** void I2C1_ER_IRQHandler(void)
  69:../i2c.c      **** {
 205              		.loc 1 69 0
 206              		.cfi_startproc
 207              		@ args = 0, pretend = 0, frame = 0
 208              		@ frame_needed = 1, uses_anonymous_args = 0
 209              		@ link register save eliminated.
 210 0158 80B4     		push	{r7}
 211              	.LCFI3:
 212              		.cfi_def_cfa_offset 4
 213              		.cfi_offset 7, -4
 214 015a 00AF     		add	r7, sp, #0
 215              	.LCFI4:
 216              		.cfi_def_cfa_register 7
  70:../i2c.c      **** 	dgbcnt_ER++;
 217              		.loc 1 70 0
 218 015c 40F20003 		movw	r3, #:lower16:dgbcnt_ER
 219 0160 C0F20003 		movt	r3, #:upper16:dgbcnt_ER
 220 0164 1B68     		ldr	r3, [r3, #0]
 221 0166 03F10102 		add	r2, r3, #1
 222 016a 40F20003 		movw	r3, #:lower16:dgbcnt_ER
 223 016e C0F20003 		movt	r3, #:upper16:dgbcnt_ER
 224 0172 1A60     		str	r2, [r3, #0]
  71:../i2c.c      **** 
  72:../i2c.c      **** 	if (dgbcnt_ER == 100)
  73:../i2c.c      **** 	{
  74:../i2c.c      **** 
  75:../i2c.c      **** 	}
  76:../i2c.c      **** 
  77:../i2c.c      **** }
 225              		.loc 1 77 0
 226 0174 BD46     		mov	sp, r7
 227 0176 80BC     		pop	{r7}
 228 0178 7047     		bx	lr
 229              		.cfi_endproc
 230              	.LFE30:
 232 017a 00BF     		.align	2
 233              		.global	I2C1_EV_IRQHandler
 234              		.thumb
 235              		.thumb_func
 237              	I2C1_EV_IRQHandler:
 238              	.LFB31:
  78:../i2c.c      **** 
  79:../i2c.c      **** void I2C1_EV_IRQHandler(void)
  80:../i2c.c      **** {
 239              		.loc 1 80 0
 240              		.cfi_startproc
 241              		@ args = 0, pretend = 0, frame = 0
 242              		@ frame_needed = 1, uses_anonymous_args = 0
 243              		@ link register save eliminated.
 244 017c 80B4     		push	{r7}
 245              	.LCFI5:
 246              		.cfi_def_cfa_offset 4
 247              		.cfi_offset 7, -4
 248 017e 00AF     		add	r7, sp, #0
 249              	.LCFI6:
 250              		.cfi_def_cfa_register 7
  81:../i2c.c      **** 	dgbcnt_EV++;
 251              		.loc 1 81 0
 252 0180 40F20003 		movw	r3, #:lower16:dgbcnt_EV
 253 0184 C0F20003 		movt	r3, #:upper16:dgbcnt_EV
 254 0188 1B68     		ldr	r3, [r3, #0]
 255 018a 03F10102 		add	r2, r3, #1
 256 018e 40F20003 		movw	r3, #:lower16:dgbcnt_EV
 257 0192 C0F20003 		movt	r3, #:upper16:dgbcnt_EV
 258 0196 1A60     		str	r2, [r3, #0]
  82:../i2c.c      **** 
  83:../i2c.c      **** 	if (dgbcnt_EV == 100)
  84:../i2c.c      **** 	{
  85:../i2c.c      **** 
  86:../i2c.c      **** 	}
  87:../i2c.c      **** }
 259              		.loc 1 87 0
 260 0198 BD46     		mov	sp, r7
 261 019a 80BC     		pop	{r7}
 262 019c 7047     		bx	lr
 263              		.cfi_endproc
 264              	.LFE31:
 266              	.Letext0:
 267              		.file 2 "/opt/CodeSourcery/arm-2011.09/bin/../lib/gcc/arm-none-eabi/4.6.1/../../../../arm-none-eab
 268              		.file 3 "/home/simon/workspace/stm32vl/stm32_lib/inc/stm32f10x.h"
 269              		.file 4 "/home/simon/workspace/stm32vl/stm32_lib/inc/stm32f10x_gpio.h"
 270              		.file 5 "/home/simon/workspace/stm32vl/stm32_lib/inc/misc.h"
 271              		.file 6 "/home/simon/workspace/stm32vl/stm32_lib/inc/stm32f10x_i2c.h"
 272              		.file 7 "/home/simon/workspace/stm32vl/stm32_lib/inc/core_cm3.h"
DEFINED SYMBOLS
                            *ABS*:00000000 i2c.c
     /tmp/cc642rj5.s:18     .text:00000000 $t
     /tmp/cc642rj5.s:23     .text:00000000 i2c_cofig
     /tmp/cc642rj5.s:189    .bss:00000000 dgbcnt_ER
     /tmp/cc642rj5.s:186    .bss:00000000 $d
     /tmp/cc642rj5.s:195    .bss:00000004 dgbcnt_EV
     /tmp/cc642rj5.s:203    .text:00000158 I2C1_ER_IRQHandler
     /tmp/cc642rj5.s:237    .text:0000017c I2C1_EV_IRQHandler
                     .debug_frame:00000010 $d

UNDEFINED SYMBOLS
RCC_APB2PeriphClockCmd
RCC_APB1PeriphClockCmd
I2C_DeInit
GPIO_StructInit
GPIO_Init
I2C_StructInit
I2C_Init
I2C_Cmd
NVIC_Init
I2C_CalculatePEC
I2C_ITConfig
